(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))p(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&p(f)}).observe(document,{childList:!0,subtree:!0});function u(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function p(e){if(e.ep)return;e.ep=!0;const o=u(e);fetch(e.href,o)}})();console.log("popup.js loaded successfully");document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("classify"),m=document.getElementById("view-responses"),u=document.getElementById("responses-list"),p=document.getElementById("responses-table"),e=(r,c)=>{const t=new Date().toISOString();chrome.storage.sync.get("responses",l=>{const i=l.responses||[];i.push({subject:r,url:c,timestamp:t}),chrome.storage.sync.set({responses:i},()=>{console.log("Classification stored successfully:",{subject:r,url:c,timestamp:t})})})},o=r=>{chrome.storage.sync.get("responses",c=>{const t=c.responses||[];r>=0&&r<t.length&&(t.splice(r,1),chrome.storage.sync.set({responses:t},()=>{console.log(`Removed classification at index ${r}`),f()}))})},f=()=>{chrome.storage.sync.get("responses",r=>{const c=r.responses||[];if(u.innerHTML="",c.length===0){console.log("No past classifications found");const t=document.createElement("tr"),l=document.createElement("td");l.colSpan=4,l.textContent="No past classifications found.",l.style.textAlign="center",t.appendChild(l),u.appendChild(t),b();return}console.log("Displaying stored responses:",c),c.forEach((t,l)=>{const i=document.createElement("tr"),y=document.createElement("td");y.textContent=t.subject||"N/A",i.appendChild(y);const a=document.createElement("td"),s=document.createElement("a");s.href=t.url,s.textContent=t.url.length>50?t.url.substring(0,47)+"...":t.url,s.title=t.url,s.target="_blank",a.appendChild(s),a.style.wordWrap="break-word",a.style.maxWidth="200px",i.appendChild(a);const x=document.createElement("td");x.textContent=new Date(t.timestamp).toLocaleString(),i.appendChild(x);const h=document.createElement("td"),d=document.createElement("button");d.textContent="X",d.style.color="white",d.style.backgroundColor="black",d.style.border="none",d.style.cursor="pointer",d.style.padding="2px 5px",d.style.fontSize="12px",d.style.borderRadius="3px",d.addEventListener("click",()=>{o(l)}),h.appendChild(d),i.appendChild(h),u.appendChild(i)}),p.style.display="table",b()})},g=()=>{const r=document.getElementById("result"),c=document.getElementById("extracted-text"),t=document.getElementById("source");n.disabled=!0,n.style.backgroundColor="#cccccc",n.innerText="Classifying...",r.innerText="",c.innerText="",c.style.display="none",t.innerText="",chrome.tabs.query({active:!0,currentWindow:!0},l=>{if(l.length===0){console.error("No active tab found"),n.disabled=!1,n.style.backgroundColor="",n.innerText="Classify",r.innerText="No active tab found!";return}const i=new URL(l[0].url);chrome.scripting.executeScript({target:{tabId:l[0].id},func:y=>{{const s=document.querySelector('[data-testid="tweetText"]');return s?{text:s.innerText,source:"tweet"}:{text:"Unable to extract tweet text.",source:"tweet"}}const a=["#mw-content-text","main","article"];for(let s of a){const x=document.querySelector(s);if(x&&x.innerText.trim())return{text:x.innerText.substring(0,5e3),source:s}}return{text:document.body.innerText.substring(0,5e3),source:"all"}},args:[i.hostname]},y=>{if(chrome.runtime.lastError){console.error("Error extracting page content:",chrome.runtime.lastError.message),n.disabled=!1,n.style.backgroundColor="",n.innerText="Classify",r.innerText=`Error: ${chrome.runtime.lastError.message}`;return}const a=y[0].result;t.innerText=`Extracted Text Source: ${a.source}`,c.style.display="block",c.innerText=a.text,chrome.runtime.sendMessage({action:"classifyPage",content:a.text},s=>{n.disabled=!1,n.style.backgroundColor="",n.innerText="Classify",s&&s.subject?(r.innerHTML=`This page is classified as: <span>${s.subject}</span>`,e(s.subject,l[0].url)):r.innerText="Classification failed."})})})};n?n.addEventListener("click",g):console.error("Classify button not found"),m?m.addEventListener("click",()=>{console.log("View Past Classifications button clicked"),f()}):console.error("View Past Classifications button not found")});const b=()=>{chrome.storage.sync.get("responses",n=>{const m=n.responses||[],u={Mathematics:{count:0,color:"#F9584B"},Science:{count:0,color:"#E6B710"},"Social Studies":{count:0,color:"#32B7A9"},"Language Arts":{count:0,color:"#4E62E0"}};m.forEach(e=>{u[e.subject]&&(u[e.subject].count+=1)});const p=document.getElementById("hexagon-visualization");p.innerHTML="";for(const[e,{count:o,color:f}]of Object.entries(u)){const g=document.createElement("div");g.className="hexagon",g.style.backgroundColor=o>0?f:"#ffffff",g.style.color=o>0?"white":"black",g.innerHTML=`
        <div class="hexagon-content">
          <p>${e}</p>
          <p>[${o}]</p>
        </div>
      `,p.appendChild(g)}})};
