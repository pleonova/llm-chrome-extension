(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))f(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&f(d)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function f(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();console.log("popup.js loaded successfully");document.addEventListener("DOMContentLoaded",async()=>{const h=document.getElementById("classify"),a=document.getElementById("view-responses"),i=document.getElementById("responses-list"),f=document.getElementById("responses-table"),n=(r,o)=>{const e=new Date().toISOString();chrome.storage.sync.get("responses",c=>{const l=c.responses||[];l.push({subject:r,url:o,timestamp:e}),chrome.storage.sync.set({responses:l},()=>{console.log("Classification stored successfully:",{subject:r,url:o,timestamp:e})})})},s=r=>{chrome.storage.sync.get("responses",o=>{const e=o.responses||[];r>=0&&r<e.length&&(e.splice(r,1),chrome.storage.sync.set({responses:e},()=>{console.log(`Removed classification at index ${r}`),d()}))})},d=()=>{chrome.storage.sync.get("responses",r=>{const o=r.responses||[];if(i.innerHTML="",o.length===0){console.log("No past classifications found");const e=document.createElement("tr"),c=document.createElement("td");c.colSpan=4,c.textContent="No past classifications found.",c.style.textAlign="center",e.appendChild(c),i.appendChild(e),v();return}console.log("Displaying stored responses:",o),o.forEach((e,c)=>{const l=document.createElement("tr"),g=document.createElement("td");g.textContent=e.subject||"N/A",l.appendChild(g);const E=document.createElement("td"),y=document.createElement("a");y.href=e.url,y.textContent=e.url.length>50?e.url.substring(0,47)+"...":e.url,y.title=e.url,y.target="_blank",E.appendChild(y),E.style.wordWrap="break-word",E.style.maxWidth="200px",l.appendChild(E);const x=document.createElement("td");x.textContent=new Date(e.timestamp).toLocaleString(),l.appendChild(x);const m=document.createElement("td"),t=document.createElement("button");t.textContent="X",t.style.color="white",t.style.backgroundColor="black",t.style.border="none",t.style.cursor="pointer",t.style.padding="2px 5px",t.style.fontSize="12px",t.style.borderRadius="3px",t.addEventListener("click",()=>{s(c)}),m.appendChild(t),l.appendChild(m),i.appendChild(l)}),f.style.display="table",v()})},u=(r=!1,o)=>{const e=document.getElementById("result"),c=document.getElementById("extracted-text"),l=document.getElementById("source");o.disabled=!0,o.style.backgroundColor="#cccccc",o.innerText="Classifying...",e.innerText="",c.innerText="",c.style.display="none",l.innerText="",chrome.tabs.query({active:!0,currentWindow:!0},g=>{if(g.length===0){console.error("No active tab found"),o.disabled=!1,o.style.backgroundColor="",o.innerText=r?"Classify using Local Model":"Classify",e.innerText="No active tab found!";return}const E=new URL(g[0].url),y={target:{tabId:g[0].id},func:x=>{if(x==="twitter.com"||x==="x.com"){const t=document.querySelector('[data-testid="tweetText"]');return t?{text:t.innerText,source:"tweet"}:{text:"Unable to extract tweet text.",source:"tweet"}}const m=["#mw-content-text","main","article"];for(let t of m){const C=document.querySelector(t);if(C&&C.innerText.trim())return{text:C.innerText.substring(0,5e3),source:t}}return{text:document.body.innerText.substring(0,5e3),source:"all"}},args:[E.hostname]};chrome.scripting.executeScript(y,x=>{if(chrome.runtime.lastError){console.error("Error:",chrome.runtime.lastError),o.disabled=!1,o.style.backgroundColor="",o.innerText=r?"Classify using Local Model":"Classify",e.innerText=`Error: ${chrome.runtime.lastError.message}`;return}const m=x[0].result;l.innerText=`Extracted Text Source: ${m.source}`,c.style.display="block",c.innerText=m.text,chrome.runtime.sendMessage({action:"classifyPage",content:m.text,useLocalModel:r},t=>{if(o.disabled=!1,o.style.backgroundColor="",o.innerText=r?"Classify using Local Model":"Classify",t&&t.subject){e.innerHTML=`This page is classified as: <span>${t.subject}</span>`,n(t.subject,g[0].url);const C=document.getElementById("explanation");if(C&&C.remove(),t.explanation){const b=document.createElement("div");b.id="explanation",b.innerHTML=`<strong>Explanation:</strong> <em>${t.explanation}</em>`,b.style.marginBottom="20px";const T=document.getElementById("view-responses");T.parentNode.insertBefore(b,T)}}else e.innerText="Classification failed."})})})};h?h.addEventListener("click",()=>u(!1,h)):console.error("Classify button not found"),a?a.addEventListener("click",()=>{console.log("View Past Classifications button clicked"),d()}):console.error("View Past Classifications button not found");const p=document.getElementById("classifyLocalButton");p?chrome.runtime.sendMessage({action:"checkModelAvailability"},r=>{r?p.addEventListener("click",()=>u(!0,p)):(p.disabled=!0,p.style.backgroundColor="#cccccc",p.innerText="No local model available",p.style.cursor="not-allowed")}):console.error("Local classification button not found")});const v=()=>{chrome.storage.sync.get("responses",h=>{const a=h.responses||[],i={Mathematics:{count:0,color:"#F9584B"},Science:{count:0,color:"#E6B710"},"Social Studies":{count:0,color:"#32B7A9"},"Language Arts":{count:0,color:"#4E62E0"}};a.forEach(n=>{i[n.subject]&&(i[n.subject].count+=1)});const f=document.getElementById("hexagon-visualization");f.innerHTML="";for(const[n,{count:s,color:d}]of Object.entries(i)){const u=document.createElement("div");u.className="hexagon",u.style.backgroundColor=s>0?d:"#ffffff",u.style.color=s>0?"white":"black",u.innerHTML=`
        <div class="hexagon-content">
          <p>${n}</p>
          <p>[${s}]</p>
        </div>
      `,f.appendChild(u)}})};
